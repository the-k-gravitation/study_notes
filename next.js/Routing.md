 #nextjs #route

## 基于 app 的路由规则

默认下，在 `app` 下的 `components` 为 `React Server Components` .
Next.js uses a file-system based router:

- Folders are used to define routes.
- 文件夹下面的 "page.js" 文件为 默认的 Route File.

File 名约定：

|File名|说明|
|---|---|
|[`layout`](https://nextjs.org/docs/app/building-your-application/routing/pages-and-layouts#layouts)|Shared UI for a segment and its children|
|[`page`](https://nextjs.org/docs/app/building-your-application/routing/pages-and-layouts#pages)|Unique UI of a route and make routes publicly accessible|
|[`loading`](https://nextjs.org/docs/app/building-your-application/routing/loading-ui-and-streaming)|Loading UI for a segment and its children|
|[`not-found`](https://nextjs.org/docs/app/api-reference/file-conventions/not-found)|Not found UI for a segment and its children|
|[`error`](https://nextjs.org/docs/app/building-your-application/routing/error-handling)|Error UI for a segment and its children|
|[`global-error`](https://nextjs.org/docs/app/building-your-application/routing/error-handling)|Global Error UI|
|[`route`](https://nextjs.org/docs/app/building-your-application/routing/route-handlers)|Server-side API endpoint|
|[`template`](https://nextjs.org/docs/app/building-your-application/routing/pages-and-layouts#templates)|Specialized re-rendered Layout UI|
|[`default`](https://nextjs.org/docs/app/api-reference/file-conventions/default)|Fallback UI for [Parallel Routes](https://nextjs.org/docs/app/building-your-application/routing/parallel-routes)|

only the contents returned by `page.js` or `route.js` are publicly addressable。

## Layouts

# layout

A `layout.js` and `page.js` file can be defined in the same folder. The layout will wrap the page.

- Layouts are [Server Components](https://nextjs.org/docs/app/building-your-application/rendering/server-components) by default but can be set to a [Client Component](https://nextjs.org/docs/app/building-your-application/rendering/client-components).
- Passing data between a parent layout and its children is not possible.
- Can use [Route Groups](https://nextjs.org/docs/app/building-your-application/routing/route-groups) to opt specific route segments in and out of shared layouts.
- Layouts do not have access to the route segments below itself. To access all route segments, can use [`useSelectedLayoutSegment`](https://nextjs.org/docs/app/api-reference/functions/use-selected-layout-segment) or [`useSelectedLayoutSegments`](https://nextjs.org/docs/app/api-reference/functions/use-selected-layout-segments) in a Client Component

### Root Layout (Required)

- The `app` directory **must** include a root layout
- The root layout is a [Server Component](https://nextjs.org/docs/app/building-your-application/rendering/server-components) by default and **can not** be set to a [Client Component](https://nextjs.org/docs/app/building-your-application/rendering/client-components).
- The root layout must define `<html>` and `<body>` tags since Next.js does not automatically create them.
- Only the root layout can contain `<html>` and `<body>` tags.

## Template

# template

when a user navigates between routes that share a template, a new instance of the component is mounted, DOM elements are recreated, state is **not** preserved, and effects are re-synchronized.

以下情况更适合使用 `template`:

- Features that rely on `useEffect` (e.g logging page views) and `useState` (e.g a per-page feedback form).
- To change the default framework behavior. For example, Suspense Boundaries inside layouts only show the fallback the first time the Layout is loaded and not when switching pages. For templates, the fallback is shown on each navigation.

In terms of nesting, `template.js` is rendered between a layout and its children.

## Modifying \<head\>

Metadata can be defined by exporting a [`metadata` object](https://nextjs.org/docs/app/api-reference/functions/generate-metadata#the-metadata-object) or [`generateMetadata` function](https://nextjs.org/docs/app/api-reference/functions/generate-metadata#generatemetadata-function) in a [`layout.js`](https://nextjs.org/docs/app/api-reference/file-conventions/layout) or [`page.js`](https://nextjs.org/docs/app/api-reference/file-conventions/page) file.

```jsx
export const metadata = {
 title: 'Create Next App',
 description: 'Generated by create next app',
}
```
